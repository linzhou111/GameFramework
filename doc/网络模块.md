# 网络通信模块

数据协议用Protobufjs，网络协议用WebSocket

- Protobufjs

具体查看博客: https://blog.csdn.net/wxc237786026/article/details/91352096

---

- WebSocket

CocosCreator已经支持WebSocket，而如果是微信小游戏则用微信提供的WebSocket，具体查看：https://developers.weixin.qq.com/minigame/dev/api/network/websocket/wx.connectSocket.html

工程中两种都实现了，其中浏览器平台已经测试过可行，并且提供了Nodejs服务端工程。

---

- 服务端(hello-ws)

1、假设已经安装了nodejs和npm

2、用VSCode打开工程，并且运行

---

- 客户端

ProtoBuf.ts：对protobufjs的修改和封装

ProtoLoader.ts：用于加载proto文件

Message.ts：proto msg的基类，并将msg缓存起来

ProtoMessage.ts：插件根据proto文件生成的代码

Socket.ts：WebSocket/WxSocket的具体实现

NetWork.ts：这个类的功能有点复杂，后续可以简化  
对Socket，提供统一回调接口供具体Socket类调用  
对用户，提供了connect, send等基础方法  
本身实现了发包时封装协议，收包时解析协议的方法

---

- 如何使用

```typescript
// 创建连接
let network = new NetWork();
let url = 'ws://localhost:3000';
network.connect(url);

// 跟protobuf一起使用
let login = new Login();
login.cmd = 'login';
login.name = 'Clever';
login.pw = '123456';
network.send(login);
```
---
